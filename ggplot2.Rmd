---
title: "ggplot2"
author: "Anita Owens"
date: "January 16, 2016"
output: html_document
---
What is ggplot2?
-Grammar of graphics represents and abstraction of graphics ideas/objects
-Think "verb", "noun," "adjective" for graphics
-allows for a "theory of graphics" on which to build new graphics and graphics objects
-shorten the distance from mind to page

THE BASICS
-works much like the plot function in base graphics system 
-looks for data in data frame, similar to lattice, or in the parent environment
-plots are made up of aesthetics (size, shape, color) and geoms (points, lines)

data must come from the data frame as well as well as the variables but you don't have to specify the data frame but you should for reproducibility

-factors are important for inducating subsets of the data (if they are to have different properties); they should be labeled
-the qplot() hides what goes on underneath which is okay for most operations
--ggplot()is the core function and very flexible for doing things qplot() cannot do

When you have factor variables you want to make sure that they're propertly labeled

```{r}
library(ggplot2)
str(mpg)

#the colors and legend is automatically added
qplot(displ, hwy, data = mpg, color = drv)

```
adding a statistic
```{r}
#add lowS or smoother function
#you can see the trends in the data set
#the gray zone is the 95% confidence intervals
qplot(displ, hwy, data = mpg, geom = c("point", "smooth"))
```
histograms
```{r}
qplot( hwy, data = mpg)
qplot( hwy, data = mpg, fill = drv)
qplot( hwy, data = mpg, fill = drv, bins = 40)
```
Facets
-are like panels in lattice
-you can create separate plots

a variable on the left hand side ~ a variable on the right hand side (of the tilde ~ )

#the variables on the right hand side determine the columns of the panels
#the variables on the left determine the rows of this kind of matrix
```{r}
#scatterplots
#the drv has 3 levels so it has 3 columns
#since there is only 1 row, all 3 plots will be in a row
qplot(displ, hwy, data = mpg, facets = .~ drv)

#histograms
#the drv variable is on the left hand side
qplot(hwy, data = mpg, facets =  drv ~., binwidth = 2)
```
Histogram by group
#example code but data not available
```{r}
qplot(log(eno), data = maacs, fill = mopos)
```
another way to visualize the same data above is to do a density smooth
```{r}
qplot(log(eno), data = maacs, geom = "density")
#a nice way to visualize 1 dimensional data
qplot(log(eno), data = maacs, geom = "density", color = mopos)
```
Scatterplots
```{r}
qplot(log(pm25), log(eno), data = maacs)
qplot(log(pm25), log(eno), data = maacs, shape=mopos)
qplot(log(pm25), log(eno), data = maacs, color=mopos)
```
Smooth the relationship between a log(pm25) and log(eno)
#look at how this relationship is different in the 2 groups
#set the geom to be a pont and a smooth

```{r}
#this is a standar linear regression model (method="lm")
qplot(log(pm25), log(eno), data = maacs, color=mopos, geom = c("point", "smooth"), method="lm")
```
Another way to look at the same data is to split it with facets
```{r}
qplot(log(pm25), log(eno), data = maacs, geom = c("point", "smooth"), method="lm", facets = ,~mopos)
```
Summary of qplot()
*the qplot() function is the analog to plot() but with many built-in fatures
*syntax somewhere in between base/lattice
*produces very nice graphics, essentially publication ready (if you like the design)
*difficult to go against the grain/customize (don't bother; use ggplot2 power in that case)

Basic Components of a ggplot
-a data frame
-aesthetic mappings: how data are mapped to color, size
-geoms: geometric objects like points, lines, lines, shapes
-facets: for coditional plots.
stats: statistical transformations like binning, quantiles, smoothing, regressions
scales: what scale an aethetic map uses (example: male=red, female=blue)
-coordinate system

BUILDING PLOTS WITH GGPLOT2
-when building plots in ggplot2 (rather than using qplot) the "artist's pallete" model may be the closest analogy
-Plots are built up in layers
 *plot the data
 *overlay a summary
 *metadata and annotation
 
```{r}
#baltimore data as an example of a basic plot
#this is the relationship between 2 different variables in 2 side-by-side plots
qplot(logpm25, NocturnalSympt, data = maacs, facets = .~ bmicat, geom = c("point", "smooth"), method="lm")
```
BUilding up a plot in layers
```{r}
#dataframe
head(maacs[, 1:3])

#initial call to plot & aesthetics
g<-ggplot(maacs, aes(logpm25, NocturnalSympt))

#summary of ggplot object
#gives you a quick list of what's in the plot & in the data
summary(g)
```
NO PLOT YET

```{r}
#there is no plot if you run this code
#it does not have a layer (in other words, it doesn't know how to draw it yet)
g<-ggplot(maacs, aes(logpm25, NocturnalSympt))
print(g)

#explicity save and print ggplot object
#you can add things to your plot with the plus operator
#dont need an argument in geom_point() function
p<- g + geom_point()
print (p)

#auto-print plot object without saving
g + geom_point()
```
First plot with point layer
```{r}
#default points are a solid circle, filled circle
g<-ggplot(maacs, aes(logpm25, NocturnalSympt))
g + geom_point()
```
Adding more layers: Smoother
```{r}
#a lot of noise
g + geom_point() + geom_smooth()

#use a regular regression line instead although it is less flexible
g + geom_point() + geom_smooth(method="lm")
```

